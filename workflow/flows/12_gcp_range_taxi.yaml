id: 12_gcp_range_taxi
namespace: zoomcamp
description: Run 08_gcp_taxi for multiple month selections

inputs:
  - id: taxi
    type: SELECT
    displayName: Select taxi type
    values: [yellow, green]
    defaults: green

  - id: year
    type: SELECT
    displayName: Select year
    values: ["2019", "2020"]
    defaults: "2019"
    allowCustomValue: true # allows you to type 2021 from the UI for the homework ðŸ¤—

  - id: month
    type: MULTISELECT
    displayName: Select month
    values: ["01", "02", "03", "04", "05", "06", "07", "08", "09", "10", "11", "12"]
    defaults: ["01"]

tasks:
  - id: for_each_month
    type: io.kestra.plugin.core.flow.ForEach
    values: "{{ inputs.month }}"
    tasks:
      - id: call_gcp_taxi_subflow
        type: io.kestra.plugin.core.flow.Subflow
        namespace: zoomcamp
        flowId: 08_gcp_taxi
        inputs:
          taxi: "{{ inputs.taxi }}"
          year: "{{ inputs.year }}"
          month: "{{ taskrun.value }}"
        wait: true
        transmitFailed: true